# Работа с потоками в NodeJS

## Условия

Необходимо отсортировать большой файл со случайными целыми числами, размером 100 МБ, в условиях ограниченной оперативной памяти - 50 МБ. Решение должно быть построено с использованием потоков.

Для решения задачи можно использовать алгоритм “Сортировка слиянием”.
Процесс можно разделить на 3 этапа.

Этап 0
Любым удобным вам способом создаем исходный файл с числами размером 100 МБ.

Этап 1
Исходный файл с числами необходимо разбить на несколько файлов поменьше, предварительно отсортировав их независимо друг от друга.

Этап 2
Необходимо создать механизм чтения чисел сразу из нескольких файлов (потоков).
Читать данные из потоков следует по принципу pause/resume.

Этап 3
Необходимо создать цикл, который будет работать с данными сразу из всех потоков.
Такой цикл будет прерван только тогда, когда будут полностью прочитаны все файлы.
В цикле следует искать наименьшее значение и записывать его в итоговый файл.
1 итерация = 1 число

Для проверки решения, скрипт необходимо запустить командой
$ node --max-old-space-size=50 script.js 

## Реализация

Задание выполнено в виде двух сценариев NodeJS: `script.js` и `check.js`.

### Подготовка к запуску

```
npm i
```

### Запуск

```
node --max-old-space-size=50 script.js
```

Во время выполнения этой команды будут последовательно созданы файлы `source.txt`, `part-*.txt` (множество файлов такого вида) и `output.txt`. Далее приведён пример ожидаемого вывода в консоль. Также вывод можно перенаправить в файл с помощью команды вида `node --max-old-space-size=50 script.js > log.txt`. Работа программы разбита на несколько этапов; некоторые отладочные сообщения помечены названиями этих этапов в квадратных скобках: 

* `[Create source file]` - создание файла `source.txt`, содержащего много неупорядоченных целых чисел, 
* `[Split into parts]` - разбиение файла `source.txt` на множество файлов вида `part-*.txt`, каждый из которых содержит часть чисел из исходного файла, упорядоченных по возрастанию,
* `[Merge]` - слияние файлов вида `part-*.txt` в файл `output.txt`, содержащий все те же числа, что и исходный файл, но в порядке возрастания.

```
Run...
[Create source file] 6% completed
[Create source file] 13% completed
...
[Create source file] 100% completed
[Split into parts] Begin...
[Split into parts] Pipeline succeeded.
part-0.txt
part-1.txt
...
part-7.txt
[Merge] Written number count: 73892.
[Merge] Written number count: 89311.
...
[Merge] Written number count: 1600000.
OK
```

### Проверка

Чтобы проверить, что условия задания выполняются, надо запустить команду

```
node check
```

Она запускается без ограничений по потребляемой памяти. Этот сценарий проверяет, что содержимое файлов `source.txt` и `output.txt` совпадает в терминах мультимножеств (т. е. каждый элемент должен встречаться одинаковое количество раз в обоих файлах), и элементы из файла `output.txt` упорядочены по возрастанию. Если какое-то из условий не выполняется, сценарий бросает ошибку. Пример ожидаемого вывода в случае удовлетворения требований:

```
Source file numbers count: 15300000.
Destination file numbers count: 15300000.
Checked: 0%
Checked: 6%
...
Checked: 100%
OK
```
